<script module lang="ts">
	export type Platform = 'auto' | 'mac' | 'pc';
</script>

<script lang="ts">
	import type { HTMLAttributes } from 'svelte/elements';

	const keyIcons = {
		Cmd,
		Ctrl,
		Alt,
		Shift,
		Enter,
		Delete,
		Esc,
		Up,
		Down,
		Left,
		Right,
		Space,
		Tab,
		MouseLeft,
		MouseRight,
		MouseMiddle
	};

	type Key =
		| {
				key: keyof typeof keyIcons;
				props: HTMLAttributes<HTMLElement>;
		  }
		| string;

	let {
		keys,
		props,
		platform = 'auto'
	}: {
		props?: HTMLAttributes<HTMLElement>;
		keys: Key[];
		platform?: Platform;
	} = $props();

	const isMac = $derived.by(() => {
		return platform == 'auto'
			? typeof navigator !== 'undefined'
				? /Mac|iPhone|iPod|iPad/.test(navigator.platform)
				: false
			: platform == 'mac';
	});

	const omit = <T extends Record<string, any> | undefined>(
		props: T,
		...keys: (keyof NonNullable<T>)[]
	): T => {
		if (!props) return undefined as T;
		let cp: Record<string, any> = {};
		for (let k in props) {
			if (keys.includes(k)) continue;
			cp[k] = props[k];
		}
		return cp as T;
	};
</script>

{#snippet Down()}
	<svg viewBox="0 0 9 10" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path
			d="M8.7832 0.626953C8.7832 0.240234 8.49023 0 8.0332 0H0.744141C0.292969 0 0 0.234375 0 0.621094C0 0.832031 0.0878906 0.996094 0.199219 1.21875L3.69727 8.44336C3.91406 8.87695 4.11328 9.01758 4.38867 9.01758C4.66992 9.01758 4.86914 8.87695 5.08594 8.44336L8.58398 1.21875C8.69531 0.996094 8.7832 0.832031 8.7832 0.626953Z"
			fill="currentColor"
		/>
	</svg>
{/snippet}

{#snippet Up()}
	<svg viewBox="0 0 9 10" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path
			d="M8.7832 8.39062C8.7832 8.18555 8.69531 8.02148 8.58398 7.79883L5.08594 0.574219C4.86914 0.140625 4.66992 0 4.38867 0C4.11328 0 3.91406 0.140625 3.69727 0.574219L0.199219 7.79883C0.0878906 8.02148 0 8.18555 0 8.39648C0 8.7832 0.292969 9.01758 0.744141 9.01758H8.0332C8.49023 9.01758 8.7832 8.77734 8.7832 8.39062Z"
			fill="currentColor"
		/>
	</svg>
{/snippet}

{#snippet Left()}
	<svg viewBox="0 0 10 9" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path
			d="M0.632812 8.7832C0.837891 8.7832 1.00195 8.69531 1.22461 8.58398L8.44336 5.08594C8.88281 4.86914 9.02344 4.66992 9.02344 4.39453C9.02344 4.11328 8.88281 3.91406 8.44336 3.69727L1.22461 0.199219C0.996094 0.0878906 0.832031 0 0.626953 0C0.240234 0 0 0.292969 0 0.744141L0.00585938 8.03906C0.00585938 8.49023 0.246094 8.7832 0.632812 8.7832Z"
			fill="currentColor"
		/>
	</svg>
{/snippet}

{#snippet Right()}
	<svg viewBox="0 0 10 9" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path
			d="M8.39648 0C8.18555 0 8.02148 0.0878906 7.79883 0.199219L0.580078 3.69727C0.140625 3.91406 0 4.11328 0 4.39453C0 4.66992 0.140625 4.86914 0.580078 5.08594L7.79883 8.58398C8.02734 8.69531 8.19141 8.7832 8.40234 8.7832C8.7832 8.7832 9.01758 8.49023 9.01758 8.03906V0.744141C9.01758 0.292969 8.77734 0 8.39648 0Z"
			fill="currentColor"
		/>
	</svg>
{/snippet}

{#snippet Delete()}
	<svg width="9" height="9" viewBox="0 0 9 9" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path
			d="M7.29412 8C8.09314 8 8.5 7.60663 8.5 6.78963V2.2255C8.5 1.41354 8.09314 1 7.29412 1H4.11275C3.64706 1 3.26961 1.13112 2.94608 1.48919L0.872549 3.74352C0.612745 4.02594 0.5 4.25793 0.5 4.49496C0.5 4.73199 0.612745 4.96398 0.872549 5.25144L2.94608 7.50576C3.27451 7.86383 3.65196 7.99496 4.11765 7.99496L7.29412 8ZM7.26471 7.24352H4.09314C3.83824 7.24352 3.68137 7.18804 3.5049 7.00144L1.44608 4.76729C1.33824 4.64625 1.30392 4.57061 1.30392 4.49496C1.30392 4.41931 1.34314 4.34366 1.44608 4.22767L3.5 1.99352C3.67647 1.80692 3.83824 1.75648 4.08824 1.75648H7.26471C7.58333 1.75648 7.76471 1.933 7.76471 2.28098V6.71902C7.76471 7.067 7.58333 7.24352 7.26471 7.24352ZM3.97549 6.09366C4.07353 6.09366 4.16176 6.05331 4.22549 5.98775L5.17157 5.00432L6.12745 5.98775C6.19118 6.05331 6.27451 6.09366 6.37745 6.09366C6.56863 6.09366 6.72059 5.93228 6.72059 5.73055C6.72059 5.62968 6.68627 5.54899 6.61765 5.47839L5.66667 4.5L6.62255 3.51657C6.69118 3.44092 6.72549 3.36527 6.72549 3.26945C6.72549 3.06772 6.57353 2.91138 6.37745 2.91138C6.28922 2.91138 6.21078 2.94164 6.14216 3.01729L5.17157 4.00072L4.21569 3.02233C4.15196 2.95173 4.07353 2.91643 3.97549 2.91643C3.78431 2.91643 3.62745 3.07277 3.62745 3.2745C3.62745 3.37032 3.66667 3.45605 3.73529 3.51657L4.68627 4.5L3.73529 5.48343C3.66667 5.54899 3.62745 5.63473 3.62745 5.73055C3.62745 5.93228 3.78431 6.09366 3.97549 6.09366Z"
			fill="currentColor"
		/>
	</svg>
{/snippet}

{#snippet Space()}
	<svg width="9" height="9" viewBox="0 0 9 9" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path d="M1 5.5V3.5H1.84992V4.82057H7.15008V3.5H8V5.5H1Z" fill="currentColor" />
	</svg>
{/snippet}

{#snippet Ctrl()}
	{#if isMac}
		<svg width="9" height="9" viewBox="0 0 9 9" fill="none" xmlns="http://www.w3.org/2000/svg">
			<path
				d="M0.644404 6.09283L4.13418 2.17932C4.23526 2.06329 4.36041 2 4.5 2C4.63959 2.00527 4.76955 2.06329 4.87064 2.1846L8.36041 6.0981C8.45187 6.19304 8.5 6.31962 8.5 6.4673C8.5 6.76793 8.29302 7 8.01865 7C7.88869 7 7.76354 6.94198 7.67208 6.84177L4.50481 3.28165L1.32792 6.84177C1.24128 6.94198 1.11613 7 0.981348 7C0.711793 7 0.5 6.76793 0.5 6.4673C0.5 6.31962 0.552948 6.19304 0.644404 6.09283Z"
				fill="currentColor"
			/>
		</svg>
	{:else}
		Ctrl
	{/if}
{/snippet}

{#snippet Alt()}
	{#if isMac}
		<svg width="9" height="9" viewBox="0 0 9 9" fill="none" xmlns="http://www.w3.org/2000/svg">
			<path
				d="M2.81205 1C3.18071 1 3.48091 1.19573 3.63364 1.52539L6.11949 6.95953C6.17742 7.078 6.26169 7.13466 6.40915 7.13466H8.0418C8.2946 7.13466 8.5 7.32524 8.5 7.56733C8.5 7.80427 8.2946 8 8.0418 8H6.18269C5.78769 8 5.53489 7.84032 5.36636 7.47461L2.86998 2.03532C2.81731 1.922 2.72778 1.86534 2.59612 1.86534H0.963463C0.700132 1.86534 0.5 1.67991 0.5 1.43267C0.5 1.19058 0.705398 1 0.963463 1H2.81205ZM8.0418 1C8.29987 1 8.5 1.18543 8.5 1.42752C8.5 1.67476 8.29987 1.86019 8.0418 1.86019H5.65076C5.39269 1.86019 5.19783 1.67476 5.19783 1.42752C5.19783 1.18543 5.39269 1 5.65076 1H8.0418Z"
				fill="currentColor"
			/>
		</svg>
	{:else}
		Alt
	{/if}
{/snippet}

{#snippet Shift()}
	{#if isMac}
		<svg width="9" height="9" viewBox="0 0 9 9" fill="none" xmlns="http://www.w3.org/2000/svg">
			<path
				d="M3.38834 8H5.61166C6.18238 8 6.48015 7.66953 6.48015 7.12876V5.54649H7.89454C8.23697 5.54649 8.5 5.33619 8.5 5.01574C8.5 4.81545 8.40571 4.67525 8.2469 4.52003L4.98635 1.23033C4.84739 1.09013 4.68362 1 4.5 1C4.32134 1 4.15261 1.09013 4.01365 1.23033L0.753102 4.52003C0.58933 4.68526 0.5 4.81545 0.5 5.01574C0.5 5.33619 0.76799 5.54649 1.10546 5.54649H2.52481V7.12876C2.52481 7.66953 2.82258 8 3.38834 8ZM3.50744 7.26896C3.38337 7.26896 3.29901 7.18383 3.29901 7.06366V4.98569C3.29901 4.89056 3.26427 4.85551 3.16998 4.85551H1.55211C1.53226 4.85551 1.52233 4.84549 1.52233 4.83548C1.52233 4.82546 1.5273 4.81545 1.53722 4.80544L4.45534 1.88126C4.47022 1.86624 4.48511 1.86123 4.5 1.86123C4.51985 1.86123 4.53474 1.86624 4.54963 1.88126L7.46278 4.80544C7.47767 4.81545 7.48263 4.82546 7.48263 4.83548C7.48263 4.84549 7.4727 4.85551 7.45285 4.85551H5.83002C5.74069 4.85551 5.70596 4.89056 5.70596 4.98569V7.06366C5.70596 7.17883 5.61663 7.26896 5.49752 7.26896H3.50744Z"
				fill="currentColor"
			/>
		</svg>
	{:else}
		Shift
	{/if}
{/snippet}

{#snippet Cmd()}
	{#if isMac}
		<svg viewBox="0 0 9 9" fill="none" xmlns="http://www.w3.org/2000/svg">
			<path
				d="M2.82789 3.6171V5.3829H2.06707C1.20405 5.3829 0.5 6.05855 0.5 6.92725C0.5 7.79595 1.20405 8.5 2.06707 8.5C2.93009 8.5 3.62846 7.79595 3.62846 6.92725V6.17779H5.37154V6.92725C5.37154 7.79595 6.06991 8.5 6.93293 8.5C7.80163 8.5 8.5 7.79595 8.5 6.92725C8.5 6.05855 7.80163 5.3829 6.93293 5.3829H6.17779V3.6171H6.93293C7.80163 3.6171 8.5 2.94145 8.5 2.07275C8.5 1.20405 7.80163 0.5 6.93293 0.5C6.06991 0.5 5.37154 1.20405 5.37154 2.07275V2.82221H3.62846V2.07275C3.62846 1.20405 2.93009 0.5 2.06707 0.5C1.20405 0.5 0.5 1.20405 0.5 2.07275C0.5 2.94145 1.20405 3.6171 2.06707 3.6171H2.82789ZM2.07275 2.83357C1.65259 2.83357 1.31192 2.4929 1.31192 2.07275C1.31192 1.65259 1.65259 1.31192 2.06707 1.31192C2.48155 1.31192 2.82221 1.65259 2.82221 2.07842V2.83357H2.07275ZM6.92725 2.83357H6.17779V2.07842C6.17779 1.65259 6.52413 1.31192 6.93293 1.31192C7.34741 1.31192 7.69375 1.65259 7.69375 2.07275C7.69375 2.4929 7.34741 2.83357 6.92725 2.83357ZM3.63414 5.39425V3.61143H5.37154V5.39425H3.63414ZM2.07275 6.16075H2.82221V6.92158C2.82221 7.34173 2.48155 7.68808 2.06707 7.68808C1.65259 7.68808 1.31192 7.34173 1.31192 6.92725C1.31192 6.5071 1.65259 6.16075 2.07275 6.16075ZM6.92725 6.16075C7.34741 6.16075 7.69375 6.5071 7.69375 6.92725C7.69375 7.34173 7.34741 7.68808 6.93293 7.68808C6.52413 7.68808 6.17779 7.34173 6.17779 6.92158V6.16075H6.92725Z"
				fill="currentColor"
			/>
		</svg>
	{:else}
		Ctrl
	{/if}
{/snippet}

{#snippet Enter()}
	<svg width="9" height="9" viewBox="0 0 9 9" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path
			d="M3.06519 8C3.31472 8 3.47941 7.82915 3.47941 7.58794C3.47941 7.46734 3.4345 7.37186 3.35964 7.29648L2.41641 6.37688L1.77261 5.8392L2.63599 5.8794H7.15752C8.11572 5.8794 8.5 5.45729 8.5 4.53266V2.34673C8.5 1.38693 8.11572 1 7.15752 1H5.20618C4.95165 1 4.78197 1.19095 4.78197 1.42211C4.78197 1.65327 4.95165 1.84422 5.20618 1.84422H7.14754C7.52183 1.84422 7.66656 1.98995 7.66656 2.36181V4.51759C7.66656 4.89447 7.52183 5.0402 7.14754 5.0402H2.63599L1.77261 5.0804L2.41641 4.54271L3.35964 3.62312C3.4345 3.54774 3.47941 3.45729 3.47941 3.33166C3.47941 3.09045 3.31472 2.9196 3.06519 2.9196C2.96538 2.9196 2.8456 2.96985 2.76575 3.05025L0.634747 5.14573C0.544916 5.23116 0.5 5.34673 0.5 5.46231C0.5 5.57286 0.544916 5.68844 0.634747 5.77387L2.76575 7.86935C2.8456 7.94975 2.96538 8 3.06519 8Z"
			fill="currentColor"
		/>
	</svg>
{/snippet}

{#snippet Esc()}
	{#if isMac}
		esc
	{:else}
		Escape
	{/if}
{/snippet}

{#snippet Tab()}
	<svg width="9" height="9" viewBox="0 0 9 9" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path
			d="M4.75532 7.5C4.63932 7.5 4.54224 7.46127 4.46407 7.3838C4.38842 7.30633 4.35059 7.20949 4.35059 7.09329C4.35059 7.03389 4.36068 6.97837 4.38085 6.92673C4.40355 6.87508 4.43381 6.82989 4.47163 6.79116L5.31891 5.91188L6.72601 4.62589L6.85083 4.87766L5.61395 4.92802H0.919858C0.793775 4.92802 0.691647 4.88799 0.613475 4.80794C0.537825 4.72789 0.5 4.6246 0.5 4.49806C0.5 4.37411 0.537825 4.2734 0.613475 4.19593C0.691647 4.11588 0.793775 4.07586 0.919858 4.07586H5.61395L6.85083 4.12621L6.72601 4.37799L5.31891 3.08425L4.47163 2.20884C4.43381 2.17269 4.40355 2.12879 4.38085 2.07715C4.36068 2.02292 4.35059 1.96611 4.35059 1.90671C4.35059 1.79051 4.38842 1.69367 4.46407 1.6162C4.54224 1.53873 4.63932 1.5 4.75532 1.5C4.86627 1.5 4.96588 1.5439 5.05414 1.6317L7.55059 4.18431C7.59346 4.22821 7.62624 4.27728 7.64894 4.3315C7.67163 4.38573 7.68298 4.44125 7.68298 4.49806C7.68298 4.55746 7.67163 4.61556 7.64894 4.67237C7.62624 4.7266 7.59346 4.77437 7.55059 4.81569L5.05414 7.3683C4.96588 7.4561 4.86627 7.5 4.75532 7.5ZM8.09149 7.5C7.97549 7.5 7.87841 7.46127 7.80024 7.3838C7.72206 7.30633 7.68298 7.20949 7.68298 7.09329V1.91446C7.68298 1.79567 7.72206 1.69755 7.80024 1.62008C7.87841 1.54003 7.97549 1.5 8.09149 1.5C8.20749 1.5 8.30457 1.54003 8.38274 1.62008C8.46091 1.69755 8.5 1.79567 8.5 1.91446V7.09329C8.5 7.20949 8.46091 7.30633 8.38274 7.3838C8.30457 7.46127 8.20749 7.5 8.09149 7.5Z"
			fill="currentColor"
		/>
	</svg>
{/snippet}

{#snippet MouseLeft()}
	<svg viewBox="0 0 1800 1800" xmlns="http://www.w3.org/2000/svg">
		<path
			d="m10.484375 450.98353c-.752 0-1.4538175.239-2.0234375.64453-.88567.63055-1.4609375 1.67061-1.4609375 2.83985v4.03209c.00003.27537.2226769.4989.4980469.5l4.0097651.008c.27613-.00003.49997-.22387.5-.5l-.007812-6.98931v-.002-.0352c-.001-.27524-.22466-.49793-.5-.49796zm2.515625 0v1h2.508368c1.38452 0 2.484375 1.09985 2.484375 2.48438v9.04771c0 1.38452-1.099855 2.48438-2.484375 2.48438h-5.023993c-1.38452 0-2.484375-1.09986-2.484375-2.48438v-3.51562h-1v3.51562c0 1.92123 1.563145 3.48438 3.484375 3.48438h5.023993c1.92123 0 3.484375-1.56314 3.484375-3.48438v-9.04771c0-1.92123-1.563145-3.48438-3.484375-3.48438z"
			transform="matrix(100 0 0 100 -599.6372 -44999.17700000001)"
			fill="currentColor"
		/>
	</svg>
{/snippet}

{#snippet MouseRight()}
	<svg viewBox="0 0 1800 1800" xmlns="http://www.w3.org/2000/svg">
		<path
			d="m57.512484 450.98438c.752 0 1.453818.239 2.023438.64453.88567.63055 1.460937 1.67061 1.460937 2.83985v4.03124c-.00003.27537-.222677.4989-.498047.5l-4.009765.008c-.27613-.00003-.49997-.22387-.5-.5l.0078-6.98846v-.002-.0352c.001-.27524.22466-.49793.5-.49796zm-2.515625 0v1h-2.512484c-1.38452 0-2.484375 1.09985-2.484375 2.48438v9.04686c0 1.38452 1.099855 2.48438 2.484375 2.48438h5.028109c1.38452 0 2.484375-1.09986 2.484375-2.48438v-3.51562h1v3.51562c0 1.92123-1.563145 3.48438-3.484375 3.48438h-5.028109c-1.92123 0-3.484375-1.56314-3.484375-3.48438v-9.04686c0-1.92123 1.563145-3.48438 3.484375-3.48438z"
			transform="matrix(100 0 0 100 -4799.843 -44999.219)"
			fill="currentColor"
		/>
	</svg>
{/snippet}

{#snippet MouseMiddle()}
	<svg viewBox="0 0 1800 1800" xmlns="http://www.w3.org/2000/svg">
		<path
			id="path1"
			d="m31.484375 450.99458c-1.92123 0-3.484375 1.56315-3.484375 3.48438v9.03666c0 1.92123 1.563145 3.48438 3.484375 3.48438h5.082348c1.92123 0 3.484375-1.56315 3.484375-3.48438v-9.03666c0-1.92123-1.563145-3.48438-3.484375-3.48438zm0 1h5.082348c1.38453 0 2.484375 1.09985 2.484375 2.48438v9.03666c0 1.38453-1.099845 2.48438-2.484375 2.48438h-5.082348c-1.38453 0-2.484375-1.09985-2.484375-2.48438v-9.03666c0-1.38453 1.099845-2.48438 2.484375-2.48438zm1.5625 1c-.57133 0-1.046875.47555-1.046875 1.04688v4.91166c0 .57133.475545 1.04688 1.046875 1.04688h1.973036c.57133 0 1.046875-.47555 1.046875-1.04688v-4.91166c0-.57133-.475545-1.04688-1.046875-1.04688z"
			transform="matrix(99.598235 0 0 100 -2688.8846 -44999.729)"
			fill="currentColor"
		/></svg
	>
{/snippet}

<samp
	class="trioxide_kbd {props?.class?.toString() || 'trioxide_kbd-default'}"
	{...omit(props, 'class')}
>
	{#each keys as key}
		{@const props = typeof key == 'string' ? {} : key.props}
		{@const k = typeof key == 'string' ? key : key.key}
		<kbd
			class="trioxide_kbd-key {props.class?.toString() || 'trioxide_kbd-key-default'}"
			{...omit(props, 'class')}
		>
			{#if typeof document != 'undefined'}
				{#if k in keyIcons}
					{@render keyIcons[k as keyof typeof keyIcons]()}
				{:else}
					{k}
				{/if}
			{/if}
		</kbd>
	{/each}
</samp>

<style>
	.trioxide_kbd {
		font-size: inherit;
		line-height: 1;
		display: inline-flex;
	}

	.trioxide_kbd svg {
		max-height: 0.9em;
		max-width: 0.9em;
		width: 0.9em;
		height: 0.9em;
		display: inline-block;
	}

	.trioxide_kbd-key {
		font-size: 0.9em;
		line-height: 1;
	}
	.trioxide_kbd-default {
		gap: var(--spacing);
	}

	.trioxide_kbd-key-default {
		background-color: var(--trioxide_neutral-3);
		border-radius: var(--radius-sm);
		height: calc(1em + 2 * var(--spacing));
		color: var(--trioxide_neutral-11);
		border: 1px solid var(--trioxide_neutral-6);
		display: inline-flex;
		justify-content: center;
		align-items: center;
	}
</style>
